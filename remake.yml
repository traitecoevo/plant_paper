packages:
  - rmarkdown
  - tree
  - sowsear

sources:
  - R

plot_options:
  wide:
    width: 12
    height: 4
  square:
    width: 8
    height: 8
  med_square:
    width: 10
    height: 10
  large_square:
    width: 12
    height: 12

knitr_options:
  vignette:
    auto_figure_prefix: true
    chdir: true

targets:
  all:
    depends:
      - vignettes/demography.pdf
      - .ms_deps

  .ms_deps:
    depends:
      figures
    type: file
    command: ms_deps_timestamp(target_name)

  figures:
    depends:
      - output/plant.pdf
      - output/patch.pdf
      - output/emergent.pdf
      - output/fitness.pdf

  downloads/style.csl:
    download: https://raw.githubusercontent.com/citation-style-language/styles/master/methods-in-ecology-and-evolution.csl

  fitness_landscape_data:
    command: make_fitness_data()

  patch_data:
    command: make_patch_data()

  emergent_data:
    command: make_emergent_data()

  output/plant.pdf:
    command: figure_plant()
    plot: true

  output/patch.pdf:
    command: figure_patch(patch_data)
    plot: true

  output/fitness.pdf:
    command: figure_fitness_landscape(fitness_landscape_data)
    plot: true

  output/emergent.pdf:
    command: figure_emergent(emergent_data)
    plot: true

  # Compile vignette sources into Rmd:
  vignette_sources:
    depends:
      - vignettes/plant.Rmd
      - vignettes/equilibrium.Rmd
      - vignettes/patch.Rmd
      - vignettes/emergent.Rmd
      - vignettes/fitness.Rmd
  vignettes:
    depends:
      - vignettes/plant.md
      - vignettes/equilibrium.md
      - vignettes/patch.md
      - vignettes/emergent.md
      - vignettes/fitness.md

  vignettes_html:
    depends:
      - vignettes/plant.html
      - vignettes/equilibrium.html
      - vignettes/patch.html
      - vignettes/emergent.html
      - vignettes/fitness.html

  vignettes_pdf:
    depends:
    - vignettes/demography.pdf 
    - vignettes/EBT.pdf
    - vignettes/PDE.pdf

  vignettes/plant.Rmd:
    command: sowsear("vignettes/src/plant.R", output=target_name)
  vignettes/equilibrium.Rmd:
    command: sowsear("vignettes/src/equilibrium.R", output=target_name)
  vignettes/patch.Rmd:
    command: sowsear("vignettes/src/patch.R", output=target_name)
  vignettes/emergent.Rmd:
    command: sowsear("vignettes/src/emergent.R", output=target_name)
  vignettes/fitness.Rmd:
    command: sowsear("vignettes/src/fitness.R", output=target_name)

  vignettes/plant.md:
    knitr: vignette
  vignettes/equilibrium.md:
    knitr: vignette
  vignettes/patch.md:
    knitr: vignette
  vignettes/emergent.md:
    knitr: vignette
  vignettes/fitness.md:
    knitr: vignette

  vignettes/plant.pdf:
    command: pandoc_build("vignettes/plant.md", "vignettes/template.tex")

  vignettes/plant.html:
    command: render("vignettes/plant.md", quiet=TRUE)
  vignettes/equilibrium.html:
    command: render("vignettes/equilibrium.md", quiet=TRUE)
  vignettes/patch.html:
    command: render("vignettes/patch.md", quiet=TRUE)
  vignettes/emergent.html:
    command: render("vignettes/emergent.md", quiet=TRUE)
  vignettes/fitness.html:
    command: render("vignettes/fitness.md", quiet=TRUE)

  vignettes/demography.pdf:
    command: pandoc_build("vignettes/demography.md", "vignettes/template.tex", citeproc=TRUE)
    depends:
      - refs.bib
      - downloads/style.csl
  vignettes/EBT.pdf:
    command: pandoc_build("vignettes/EBT.md", "vignettes/template.tex", citeproc=TRUE)
    depends:
      - refs.bib
      - downloads/style.csl
  vignettes/PDE.pdf:
    command: pandoc_build("vignettes/PDE.md", "vignettes/template.tex")
